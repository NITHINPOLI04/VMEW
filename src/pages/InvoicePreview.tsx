import React, { useState, useEffect, useRef } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { useReactToPrint } from 'react-to-print';
import { Download, Printer, Save, Edit, ArrowLeft } from 'lucide-react';
import { useInvoiceStore } from '../stores/invoiceStore';
import { useTemplateStore } from '../stores/templateStore';
import { jsPDF } from 'jspdf';
import 'jspdf-autotable';
import { InvoiceFormData } from '../types';
import { toast } from 'react-hot-toast';

const InvoicePreview: React.FC = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { fetchInvoice, createInvoice, updateInvoice } = useInvoiceStore();
  const { letterhead, defaultInfo } = useTemplateStore();
  
  const [invoice, setInvoice] = useState<InvoiceFormData | null>(null);
  const [loading, setLoading] = useState(true);
  const [isTemp, setIsTemp] = useState(false);
  
  const invoiceRef = useRef<HTMLDivElement>(null);
  
  useEffect(() => {
    const loadInvoice = async () => {
      setLoading(true);
      
      try {
        if (id === 'temp') {
          const tempData = localStorage.getItem('invoicePreviewData');
          
          if (tempData) {
            setInvoice(JSON.parse(tempData));
            setIsTemp(true);
          } else {
            toast.error('No preview data found');
            navigate('/generate-invoice');
          }
        } else {
          const data = await fetchInvoice(id as string);
          setInvoice(data);
          setIsTemp(false);
        }
      } catch (error) {
        console.error('Error loading invoice:', error);
        toast.error('Failed to load invoice');
        navigate('/invoice-library');
      } finally {
        setLoading(false);
      }
    };
    
    loadInvoice();
  }, [id, fetchInvoice, navigate]);
  
  const handlePrint = useReactToPrint({
    content: () => invoiceRef.current,
    documentTitle: `Invoice_${invoice?.invoiceNumber}`,
    removeAfterPrint: true,
    onBeforeGetContent: () => {
      if (invoiceRef.current) {
        invoiceRef.current.classList.add('print-mode');
      }
      return Promise.resolve();
    },
    onAfterPrint: () => {
      if (invoiceRef.current) {
        invoiceRef.current.classList.remove('print-mode');
      }
    }
  });
  
  const handleGeneratePDF = () => {
    if (!invoice) return;
    
    try {
      const pdf = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4'
      });
      
      pdf.setFont('helvetica');
      
      const margin = 15;
      const pageWidth = 210;
      const pageHeight = 297;
      const contentWidth = pageWidth - (margin * 2);
      
      let yPos = 10;

      // Add the logo slightly to the left of the margin
      const logoBase64 = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QC8RXhpZgAASUkqAAgAAAAGABIBAwABAAAAAQAAABoBBQABAAAAVgAAABsBBQABAAAAXgAAACgBAwABAAAAAgAAABMCAwABAAAAAQAAAGmHBAABAAAAZgAAAAAAAABgAAAAAQAAAGAAAAABAAAABgAAkAcABAAAADAyMTABkQcABAAAAAECAwAAoAcABAAAADAxMDABoAMAAQAAAP//AAACoAMAAQAAAPQBAAADoAMAAQAAAPQBAAAAAAAA/+EOQmh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA2LTE2PC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPjkxNWRmMmRkLTcyMGItNDM1OS04M2I0LWUyNjBlOWMyYzhkNTwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5TT0xVVElPTlMgT04gQk9BUkQgLSAyPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlBvbGltZXJhIE5pdGhpbjwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3FLS0tuNXdVIHVzZXI9VUFGYkthcG8zVWsgYnJhbmQ9QkFGYktRaC1tUGcgdGVtcGxhdGU9PC94bXA6Q3JlYXRvclRvb2w+CiA8L3JkZjpEZXNjcmlwdGlvbj4KPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0ndyc/Pv/bAEMABgQFBgUEBgYFBgcHBggKEAoKCQkKFA4PDBAXFBgYFxQWFhodJR8aGyMcFhYgLCAjJicpKikZHy0wLSgwJSgpKP/bAEMBBwcHCggKEwoKEygaFhooKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKP/AABEIAfQB9AMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APqmiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKjkuIY5FSSWNXY4VWYAk+woAkooooAKKK+fPj58X9X8LeJ4tF8MTwRvDEHuneMSHc3IXnpgYP41cIObsiZzUFdn0HRXwxc/GXx7cfe8QTpzn93GifyFfa/h28/tDQNNvCSxuLaOUk9SSoNVUoyp2uRTqxqXsaFFU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rHEipGowqqMAD0Aq6k01Zak04NO70KttpWn207T21jaxTN1kSJVY/iBVyiisTUKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACuL+Ivw30Dx7DF/bELpdQjbFdQnbIo9PcexrtKKabTuhNJqzPEND/AGcvDVlerPqd/fakiHKwviNSPQ45P5iux+MROkfCTWrfSLUqPsv2WKG3j+4rYXgDoAM131FU6jbTlqSoJKyPGPAfgWLU/wBnmLRLuErPewSXI3DBWUsWQ/oteVfBF9T8TfGTSDrBLy6HZtFyD8qxKUUH3y1fXgAAwOBXP6P4N0HR9fvda03T47fUrwFZ5VJ+fLBjxnAyQKtVdJX6kulqrdDnfibd+BtVurPwt4zngW4uf3sG8lDGegYP0Unke9eRXNjcfB74leH7bwvrb32kaxMqS6fI+4qCwXJA478NgHg17v458CaB42tY4des/MePPlzxnZJHn0b09jxWB4M+DfhTwpq8ep2cd3d3sXMUl5KH8o+qgADPvRCcVGz+4JRbdz0evn/9o7T9T0bxR4c8cadbG5g05gs6jouGyM+gIJGa+gKZPDFcQvDPGkkTjayOMhh6EVnCXK7lyjzKx4+fjp4J/sf7aLy4M2zd9j8lvNz/AHf7v45xWD+zjpOpat4m8QeOtTt2totRZlt1P8W5snHqBgDNenD4XeChffax4csPOzn7ny5/3eldjDFHDEkcKLHGg2qqjAA9AKvmjFNQW5KjJtOXQ8g8V+DtZHx30DxRotoZLPygl7JuChQAVOfX5SPyrqviT8NdD8fW0I1NGgvIT+7u4QBIF7qfUfXpXb0VPO9GuhXItV3MvwvosHh3QLLSbSWaWC0jEaNMcsR7mtSiio3KCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP//Z";
      const logoWidth = 30; // Width of the logo in mm
      const logoHeight = 30; // Height of the logo in mm
      const logoX = margin - 3; // Shift logo 3mm to the left of the margin
      const logoY = 3; // Start at the top

      pdf.addImage(logoBase64, 'PNG', logoX, logoY, logoWidth, logoHeight);

      // Center the company information
      const textWidth = contentWidth; // Use the full content width for centering
      const textStartX = margin; // Start at the margin, but we'll center the text

      // Company Name
      pdf.setFontSize(20);
      pdf.setFont('helvetica', 'bold');
      pdf.setTextColor(13, 71, 161);
      const companyName = letterhead?.companyName || 'Venkateswara Marine Electrical Works';
      const companyNameWidth = pdf.getTextWidth(companyName);
      const companyNameX = (pageWidth - companyNameWidth) / 2; // Center the text
      pdf.text(companyName, companyNameX, yPos + 5);

      yPos += 10;
      pdf.setFontSize(10);
      pdf.setTextColor(0, 0, 0);

      // GST Number
      pdf.setFont('helvetica', 'bold');
      const gstLabel = 'GST No: ';
      const gstValue = letterhead?.gstNo || '37AGIPP2674H2Z0';
      const gstText = `${gstLabel}${gstValue}`;
      const gstTextWidth = pdf.getTextWidth(gstText);
      const gstTextX = (pageWidth - gstTextWidth) / 2; // Center the text

      pdf.text(gstLabel, gstTextX, yPos);
      pdf.setFont('helvetica', 'normal');
      pdf.text(gstValue, gstTextX + pdf.getTextWidth(gstLabel), yPos);
      yPos += 5;

      pdf.setFontSize(9);
      // Address Section
      const addressLabel = 'Address:  ';
      const addressValue = letterhead?.address || ' D.No.9-23-3/6, CBM Compound, Flat No. 203, Kamal Enclaves, Visakhapatnam - 03';
      const addressText = `${addressLabel} ${addressValue}`;
      const addressLines = pdf.splitTextToSize(addressText, textWidth);
      const addressTextWidth = pdf.getTextWidth(addressLines[0]);
      const addressTextX = (pageWidth - addressTextWidth) / 2; // Center the text

      pdf.setFont('helvetica', 'bold');
      pdf.text(addressLabel, addressTextX, yPos);

      pdf.setFont('helvetica', 'normal');
      const addressValueStartX = addressTextX + pdf.getTextWidth(addressLabel) + 1;
      const addressValueLines = pdf.splitTextToSize(addressValue, textWidth - pdf.getTextWidth(addressLabel) - 1);
      pdf.text(addressValueLines, addressValueStartX, yPos);
      yPos += addressValueLines.length * 4;

      // Workshop Section
      const workshopLabel = 'Workshop:  ';
      const workshopValue = letterhead?.workshop || ' Plot No.2E, Industrial Cluster, Pudi, Rambilli (M), Visakhapatnam - 11';
      const workshopText = `${workshopLabel} ${workshopValue}`;
      const workshopLines = pdf.splitTextToSize(workshopText, textWidth);
      const workshopTextWidth = pdf.getTextWidth(workshopLines[0]);
      const workshopTextX = (pageWidth - workshopTextWidth) / 2; // Center the text

      pdf.setFont('helvetica', 'bold');
      pdf.text(workshopLabel, workshopTextX, yPos);

      pdf.setFont('helvetica', 'normal');
      const workshopValueStartX = workshopTextX + pdf.getTextWidth(workshopLabel) + 1;
      const workshopValueLines = pdf.splitTextToSize(workshopValue, textWidth - pdf.getTextWidth(workshopLabel) - 1);
      pdf.text(workshopValueLines, workshopValueStartX, yPos);
      yPos += workshopValueLines.length * 4;

      // Email and Cell Section
      const emailLabel = 'Email:';
      const emailValue = letterhead?.email || 'vmew10n@gmail.com';
      const cellLabel = 'Cell:';
      const cellValue = letterhead?.cell || '9848523264';
      const separator = '  |  ';

      pdf.setFont('helvetica', 'bold');
      const emailLabelWidth = pdf.getTextWidth(emailLabel);
      const cellLabelWidth = pdf.getTextWidth(cellLabel);

      pdf.setFont('helvetica', 'normal');
      const emailValueWidth = pdf.getTextWidth(emailValue);
      const cellValueWidth = pdf.getTextWidth(cellValue);
      const separatorWidth = pdf.getTextWidth(separator);

      const totalWidth =
        emailLabelWidth +
        emailValueWidth +
        separatorWidth +
        cellLabelWidth +
        cellValueWidth;

      const startX = (pageWidth - totalWidth) / 2; // Center the entire line

      let currentX = startX;

      pdf.setFont('helvetica', 'bold');
      pdf.text(emailLabel, currentX, yPos);
      currentX += emailLabelWidth;

      pdf.setFont('helvetica', 'normal');
      pdf.text(emailValue, currentX, yPos);
      currentX += emailValueWidth;

      pdf.text(separator, currentX, yPos);
      currentX += separatorWidth;

      pdf.setFont('helvetica', 'bold');
      pdf.text(cellLabel, currentX, yPos);
      currentX += cellLabelWidth;

      pdf.setFont('helvetica', 'normal');
      pdf.text(cellValue, currentX, yPos);

      yPos += 5;

      // Adjust yPos to ensure content below starts after the logo and text
      yPos = Math.max(yPos, logoY + logoHeight + 5);

      pdf.setLineWidth(0.5);
      pdf.setDrawColor(13, 71, 161);
      pdf.line(5, yPos, pageWidth - 5, yPos);
      yPos += 8;
      yPos = Math.min(yPos, 50);
      
      pdf.setLineWidth(0.2);
      pdf.setDrawColor(0, 0, 0); 
      pdf.setFontSize(10);
      pdf.setFont('helvetica', 'bold');
      pdf.setTextColor(0, 0, 0);
      
      pdf.text(`Invoice No: ${invoice.invoiceNumber}`, margin, yPos);
      pdf.text(`Date: ${new Date(invoice.date).toLocaleDateString('en-GB')}`, margin, yPos + 5);
      
      pdf.text(`PAN No: ${defaultInfo?.panNo || 'AGIPP2674H'}`, pageWidth - margin, yPos, { align: 'right' });
      pdf.text(`MSME No: ${defaultInfo?.msmeNo || 'UDYAM-AP-10-000719'}`, pageWidth - margin, yPos + 5, { align: 'right' });
      
      yPos += 10;
      
      const buyerLines = [
        { label: "Name:", value: invoice.buyerName },
        ...invoice.buyerAddress.split('\n').map((line, i) => ({
          label: i === 0 ? "Address:" : "", value: line
        })),
        { label: "GST No:", value: invoice.buyerGst }
      ];

      const rightSideLines = [
        { label: "Vessel:", value: invoice.vessel || "" },
        { label: "E-way Bill No:", value: invoice.ewayBillNo || "" },
        { label: "P.O No:", value: invoice.poNumber || "" },
        { label: "DC No:", value: invoice.dcNumber || "" }
      ];

      const buyerBoxHeight = Math.max(
        buyerLines.length * 4 + 10,
        rightSideLines.length * 4 + 10,
        25
      );

      const leftBoxWidth = contentWidth * 0.55;
      const rightBoxWidth = contentWidth * 0.45;

      pdf.rect(margin, yPos, leftBoxWidth, buyerBoxHeight);
      pdf.setFontSize(11);
      pdf.setFont('helvetica', 'bold');
      pdf.text('Buyer Details', margin + 2, yPos + 5);

      let buyerY = yPos + 10;
      pdf.setFontSize(9);

      buyerLines.forEach(({ label, value }) => {
        if (buyerY < yPos + buyerBoxHeight - 2) {
          const labelX = margin + 2;
          const valueX = labelX + pdf.getTextWidth(label) + 1;

          pdf.setFont('helvetica', 'bold');
          pdf.text(label, labelX, buyerY);

          pdf.setFont('helvetica', 'normal');
          pdf.text(value, valueX, buyerY);

          buyerY += 4;
        }
      });

      const rightBoxX = margin + leftBoxWidth;
      pdf.rect(rightBoxX, yPos, rightBoxWidth, buyerBoxHeight);

      let rightY = yPos + 8;
      rightSideLines.forEach(({ label, value }) => {
        if (rightY < yPos + buyerBoxHeight - 2) {
          const labelX = rightBoxX + 2;
          const valueX = labelX + pdf.getTextWidth(label) + 1;

          pdf.setFont('helvetica', 'bold');
          pdf.text(label, labelX, rightY);

          pdf.setFont('helvetica', 'normal');
          pdf.text(value, valueX, rightY);

          rightY += 4;
        }
      });
      
      yPos += buyerBoxHeight + 5;
      
      let tableHeaders: string[];
      
      if (invoice.taxType === 'igst') {
        tableHeaders = [
          'Sl.\nNo.',
          'Description of Goods',
          'HSN/SAC\nCode',
          'Qty',
          'Unit',
          'Rate',
          'Taxable\nAmount',
          'IGST\n%',
          'IGST\nAmt.'
        ];
      } else {
        tableHeaders = [
          'Sl.\nNo.',
          'Description of Goods',
          'HSN/SAC\nCode',
          'Qty',
          'Unit',
          'Rate',
          'Taxable\nAmount',
          'SGST\n%',
          'SGST\nAmt.',
          'CGST\n%',
          'CGST\nAmt.'
        ];
      }
      
      let tableData: string[][];
      
      if (invoice.taxType === 'igst') {
        tableData = invoice.items.map((item, index) => [
          (index + 1).toString(),
          item.description,
          item.hsnSacCode,
          item.quantity.toString(),
          item.unit,
          item.rate.toFixed(2),
          item.taxableAmount.toFixed(2),
          `${item.igstPercentage}%`,
          item.igstAmount.toFixed(2)
        ]);
      } else {
        tableData = invoice.items.map((item, index) => [
          (index + 1).toString(),
          item.description,
          item.hsnSacCode,
          item.quantity.toString(),
          item.unit,
          item.rate.toFixed(2),
          item.taxableAmount.toFixed(2),
          `${item.sgstPercentage}%`,
          item.sgstAmount.toFixed(2),
          `${item.cgstPercentage}%`,
          item.cgstAmount.toFixed(2)
        ]);
      }
      
      const totalTaxableAmount = invoice.items.reduce((sum, item) => sum + item.taxableAmount, 0);
      const totalSgst = invoice.items.reduce((sum, item) => sum + item.sgstAmount, 0);
      const totalCgst = invoice.items.reduce((sum, item) => sum + item.cgstAmount, 0);
      const totalIgst = invoice.items.reduce((sum, item) => sum + item.igstAmount, 0);
      
      if (invoice.taxType === 'igst') {
        tableData.push([
          '', '', '', '', '', 'Total:', 
          totalTaxableAmount.toFixed(2), 
          '', 
          totalIgst.toFixed(2)
        ]);
      } else {
        tableData.push([
          '', '', '', '', '', 'Total:', 
          totalTaxableAmount.toFixed(2), 
          '', 
          totalSgst.toFixed(2), 
          '', 
          totalCgst.toFixed(2)
        ]);
      }
      
      let columnStyles: any;
      
      if (invoice.taxType === 'igst') {
        columnStyles = {
          0: { halign: 'center', cellWidth: 10 },
          1: { halign: 'left', cellWidth: 75 },
          2: { halign: 'center', cellWidth: 17 },
          3: { halign: 'center', cellWidth: 10 },
          4: { halign: 'center', cellWidth: 10 },
          5: { halign: 'right', cellWidth: 17 },
          6: { halign: 'right', cellWidth: 18 },
          7: { halign: 'center', cellWidth: 12 },
          8: { halign: 'right', cellWidth: 17 }
        };
      } else {
        columnStyles = {
          0: { halign: 'center', cellWidth: 7 },
          1: { halign: 'left', cellWidth: 55 },
          2: { halign: 'center', cellWidth: 15 },
          3: { halign: 'center', cellWidth: 9 },
          4: { halign: 'center', cellWidth: 9 },
          5: { halign: 'right', cellWidth: 17 },
          6: { halign: 'right', cellWidth: 18 },
          7: { halign: 'center', cellWidth: 12 },
          8: { halign: 'right', cellWidth: 15 },
          9: { halign: 'center', cellWidth: 12 },
          10: { halign: 'right', cellWidth: 15 }
        };
      }
      
      (pdf as any).autoTable({
        head: [tableHeaders],
        body: tableData,
        startY: yPos,
        margin: { left: margin, right: margin },
        styles: {
          fontSize: 9,
          cellPadding: 1.5,
          lineColor: [0, 0, 0],
          lineWidth: 0.1,
          textColor: [0, 0, 0],
          overflow: 'linebreak'
        },
        headStyles: {
          fillColor: [70, 130, 180],
          textColor: [255, 255, 255],
          fontStyle: 'bold',
          halign: 'center',
          valign: 'middle'
        },
        columnStyles,
        didParseCell: (data: any) => {
          if (data.row.index === tableData.length - 1) {
            data.cell.styles.fontStyle = 'bold';
            data.cell.styles.fillColor = [240, 240, 240];
          }
        },
        theme: 'grid'
      });
      
      const finalY = (pdf as any).lastAutoTable.finalY + 5;
      
      const totalsBoxWidth = 65; // Width of the totals box
      const totalsBoxX = pageWidth - margin - totalsBoxWidth;
      let totalsY = finalY;
      
      const totalsBoxHeight = invoice.taxType === 'igst' ? 20 : 25;
      
      pdf.setLineWidth(0.2);
      pdf.rect(totalsBoxX, totalsY, totalsBoxWidth, totalsBoxHeight);
      
      pdf.setFontSize(10);
      pdf.setFont('helvetica', 'normal');
      
      let lineY = totalsY + 5;
      const labelX = totalsBoxX + 3;
      const valueX = totalsBoxX + totalsBoxWidth - 3;

      pdf.text('Total Taxable Amount:', labelX, lineY);
      pdf.text(`${totalTaxableAmount.toFixed(2)}/-`, valueX, lineY, { align: 'right' });
      lineY += 4;
      
      if (invoice.taxType === 'igst') {
        pdf.text('Total IGST:', labelX, lineY);
        pdf.text(`${totalIgst.toFixed(2)}/-`, valueX, lineY, { align: 'right' });
        lineY += 4;
      } else {
        pdf.text('Total SGST:', labelX, lineY);
        pdf.text(`${totalSgst.toFixed(2)}/-`, valueX, lineY, { align: 'right' });
        lineY += 4;
        
        pdf.text('Total CGST:', labelX, lineY);
        pdf.text(`${totalCgst.toFixed(2)}/-`, valueX, lineY, { align: 'right' });
        lineY += 4;
      }
      
      const grandTotalY = lineY;
      const grandTotalHeight = 6;
      pdf.setFillColor(70, 130, 180);
      pdf.rect(totalsBoxX, grandTotalY - 1, totalsBoxWidth, grandTotalHeight, 'F');
      
      pdf.setTextColor(255, 255, 255);
      pdf.setFont('helvetica', 'bold');
      pdf.setFontSize(10);
      pdf.text('Grand Total:', labelX, grandTotalY + 3);
      pdf.text(`${invoice.grandTotal.toFixed(2)}/-`, valueX, grandTotalY + 3, { align: 'right' });
      
      pdf.setTextColor(0, 0, 0);
      pdf.setFont('helvetica', 'normal');
      
      const amountWordsY = totalsY + totalsBoxHeight + 5;
      const amountWordsLabel = "Amount in Words:   ";
      const amountWordsValue = invoice.totalInWords;

      const fullText = `${amountWordsLabel}${amountWordsValue}`;
      const amountWordsLines = pdf.splitTextToSize(fullText, contentWidth - 6);

      const amountWordsBoxHeight = Math.max(6, amountWordsLines.length * 4 + 4);

      pdf.setLineWidth(0.2);
      pdf.rect(margin, amountWordsY, contentWidth, amountWordsBoxHeight);

      pdf.setFontSize(10);

      let wordsY = amountWordsY + 5;

      amountWordsLines.forEach((line: string, index: number) => {
        if (wordsY < amountWordsY + amountWordsBoxHeight - 2) {
          if (index === 0 && line.includes(amountWordsLabel)) {
            const labelWidth = pdf.getTextWidth(amountWordsLabel);
            const labelX = margin + 3;
            const valueX = labelX + labelWidth;

            pdf.setFont('helvetica', 'bold');
            pdf.text(amountWordsLabel, labelX, wordsY);

            pdf.setFont('helvetica', 'normal');
            pdf.text(line.substring(amountWordsLabel.length).trim(), valueX, wordsY);
          } else {
            pdf.setFont('helvetica', 'normal');
            pdf.text(line, margin + 3, wordsY);
          }

          wordsY += 4;
        }
      });
      
      const bottomY = amountWordsY + amountWordsBoxHeight + 5;
      
      const bankDetails = [
        { label: "Bank Name:", value: defaultInfo?.bankName || 'SBI' },
        { label: "A/C No:", value: defaultInfo?.accountNo || '30373757750' },
        { label: "IFSC Code:", value: defaultInfo?.ifscCode || 'SBIN0015580' },
        { label: "Branch:", value: defaultInfo?.branch || 'ASILMETTA' }
      ];
      
      const terms = defaultInfo?.terms || [
        'Goods once sold cannot be taken back.',
        'Interest @24% per annum will be charged on overdue accounts.',
        'Any dispute arising out of this transaction will be subject to Visakhapatnam jurisdiction.'
      ];
      
      const bankBoxHeight = bankDetails.length * 4 + 10;
      const termsBoxHeight = terms.length * 4 + 10;
      const maxBoxHeight = Math.max(bankBoxHeight, termsBoxHeight, 25);

      const leftBoxBottomWidth = contentWidth * 0.48;
      const rightBoxBottomWidth = contentWidth * 0.48;
      const boxGap = contentWidth * 0.04;
      
      pdf.setLineWidth(0.2);
      pdf.rect(margin, bottomY, leftBoxBottomWidth, maxBoxHeight);
      pdf.setFont('helvetica', 'bold');
      pdf.setFontSize(11);
      pdf.text('Bank Details', margin + 3, bottomY + 6);
      
      pdf.setFont('helvetica', 'normal');
      pdf.setFontSize(10);
      let bankY = bottomY + 11;
      bankDetails.forEach(({ label, value }) => {
        if (bankY < bottomY + maxBoxHeight - 2) {
          const labelX = margin + 3;
          const valueX = labelX + pdf.getTextWidth(label) + 1;

          pdf.setFont('helvetica', 'bold');
          pdf.text(label, labelX, bankY);

          pdf.setFont('helvetica', 'normal');
          pdf.text(value, valueX, bankY);

          bankY += 4;
        }
      });
      
      const rightBoxBottomX = margin + leftBoxBottomWidth + boxGap;
      pdf.rect(rightBoxBottomX, bottomY, rightBoxBottomWidth, maxBoxHeight);
      pdf.setFont('helvetica', 'bold');
      pdf.setFontSize(11);
      pdf.text('Terms & Conditions', rightBoxBottomX + 3, bottomY + 6);
      
      pdf.setFont('helvetica', 'normal');
      pdf.setFontSize(10);
      let termY = bottomY + 11;
      terms.forEach((term, index) => {
        if (termY < bottomY + maxBoxHeight - 2) {
          const termText = `${index + 1}. ${term}`;
          const termLines = pdf.splitTextToSize(termText, rightBoxBottomWidth - 6);
          termLines.forEach((line: string) => {
            if (termY < bottomY + maxBoxHeight - 2) {
              pdf.text(line, rightBoxBottomX + 3, termY);
              termY += 3;
            }
          });
        }
      });
      
      const fileName = `Invoice_${invoice.invoiceNumber.replace(/[\/\\]/g, '-')}.pdf`;
      pdf.save(fileName);
      toast.success('PDF generated successfully!');
      
    } catch (error) {
      console.error('Error generating PDF:', error);
      toast.error('Failed to generate PDF. Please try again.');
    }
  };
  
  const handleSaveInvoice = async () => {
    if (!invoice) return;
    
    try {
      if (isTemp) {
        const result = await createInvoice(invoice);
        localStorage.removeItem('invoicePreviewData');
        toast.success('Invoice saved successfully');
        navigate(`/invoice-preview/${result._id}`);
      } else {
        await updateInvoice(id as string, invoice);
        toast.success('Invoice updated successfully');
      }
    } catch (error) {
      toast.error('Failed to save invoice');
    }
  };
  
  const handleEditInvoice = () => {
    if (isTemp) {
      navigate('/generate-invoice');
    } else {
      navigate(`/generate-invoice?edit=${id}`);
    }
  };
  
  if (loading) {
    return (
      <div className="flex items-center justify-center h-full">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-900"></div>
      </div>
    );
  }
  
  if (!invoice) {
    return (
      <div className="text-center py-12">
        <h2 className="text-2xl font-bold text-slate-800 mb-2">Invoice Not Found</h2>
        <p className="text-slate-600 mb-4">The requested invoice could not be found.</p>
        <button
          onClick={() => navigate('/invoice-library')}
          className="inline-flex items-center px-4 py-2 bg-blue-900 text-white rounded-md"
        >
          <ArrowLeft className="mr-2 h-5 w-5" /> Back to Library
        </button>
      </div>
    );
  }
  
  return (
    <div className="pb-12">
      <div className="flex justify-between items-center mb-6">
        <div className="flex items-center">
          <button
            onClick={() => navigate(-1)}
            className="mr-4 p-2 hover:bg-slate-100 rounded-full"
          >
            <ArrowLeft className="h-5 w-5 text-slate-700" />
          </button>
          <h1 className="text-3xl font-bold text-slate-800">
            {isTemp ? 'Invoice Preview' : `Invoice #${invoice.invoiceNumber}`}
          </h1>
        </div>
        
        <div className="flex space-x-3">
          <button
            onClick={handleEditInvoice}
            className="btn-secondary"
          >
            <Edit className="mr-2 h-5 w-5" /> Edit
          </button>
          
          {isTemp && (
            <button
              onClick={handleSaveInvoice}
              className="btn-success"
            >
              <Save className="mr-2 h-5 w-5" /> Save
            </button>
          )}
          
          <button
            onClick={handleGeneratePDF}
            className="btn-warning"
          >
            <Download className="mr-2 h-5 w-5" /> Download PDF
          </button>
          
          <button
            onClick={handlePrint}
            className="btn-primary"
          >
            <Printer className="mr-2 h-5 w-5" /> Print
          </button>
        </div>
      </div>
      
      <div className="bg-white rounded-lg shadow">
        <div 
          ref={invoiceRef} 
          className="p-6 bg-white transition-all duration-300"
        >
          <div className="letterhead mb-8 print:hidden">
            <div className="text-center border-b-2 border-blue-900 pb-4">
              <h1 className="text-3xl font-bold text-blue-900 mb-1">
                {letterhead?.companyName || 'Venkateswara Marine Electrical Works'}
              </h1>
              <p className="text-slate-600 mb-1">
                GST No: {letterhead?.gstNo || '37AGIPP2674H2Z0'}
              </p>
              <p className="text-slate-600 mb-1">
                {letterhead?.address || 'D.No.9-23-3/6, CBM Compound, Flat No. 203, Kamal Enclaves, Visakhapatnam - 03'}
              </p>
              <p className="text-slate-600 mb-1">
                Workshop: {letterhead?.workshop || 'Plot No.2E, Industrial Cluster, Pudi, Rambilli (M), Visakhapatnam - 11'}
              </p>
              <div className="flex justify-center space-x-4">
                <p className="text-slate-600">
                  Email: {letterhead?.email || 'vmew10n@gmail.com'}
                </p>
                <p className="text-slate-600">
                  Cell: {letterhead?.cell || '9848523264'}
                </p>
              </div>
            </div>
          </div>
          
          <div className="flex justify-between mb-6">
            <div>
              <h2 className="text-xl font-bold mb-1">TAX INVOICE</h2>
              <p className="text-sm">Invoice No: <span className="font-medium">{invoice.invoiceNumber}</span></p>
              <p className="text-sm">Date: <span className="font-medium">{new Date(invoice.date).toLocaleDateString('en-IN')}</span></p>
            </div>
            <div className="text-right">
              <p className="text-sm">PAN No: <span className="font-medium">{defaultInfo?.panNo || 'AGIPP2674H'}</span></p>
              <p className="text-sm">MSME No: <span className="font-medium">{defaultInfo?.msmeNo || 'UDYAM-AP-10-000719'}</span></p>
            </div>
          </div>
          
          <div className="mb-6 border border-slate-200 rounded-md p-4">
            <h3 className="font-bold border-b pb-2 mb-2">Buyer Details</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p className="text-sm font-medium">Name:</p>
                <p className="mb-2">{invoice.buyerName}</p>
                
                <p className="text-sm font-medium">Address:</p>
                <p className="mb-2 whitespace-pre-wrap">{invoice.buyerAddress}</p>
                
                <p className="text-sm font-medium">GST No:</p>
                <p className="mb-2">{invoice.buyerGst}</p>
              </div>
              <div>
                <p className="text-sm font-medium">Vessel:</p>
                <p className="mb-2">{invoice.vessel}</p>
                
                <p className="text-sm font-medium">E-way Bill No:</p>
                <p className="mb-2">{invoice.ewayBillNo}</p>
                
                <p className="text-sm font-medium">P.O. No:</p>
                <p className="mb-2">{invoice.poNumber}</p>
                
                <p className="text-sm font-medium">DC No:</p>
                <p>{invoice.dcNumber}</p>
              </div>
            </div>
          </div>
          
          <div className="mb-6 overflow-x-auto">
            <table className="min-w-full border border-slate-200">
              <thead>
                <tr className="bg-slate-50">
                  <th className="py-2 px-3 border-b border-r border-slate-200 text-left text-xs font-medium text-slate-600 uppercase tracking-wider">
                    S. No.
                  </th>
                  <th className="py-2 px-3 border-b border-r border-slate-200 text-left text-xs font-medium text-slate-600 uppercase tracking-wider">
                    Description of Goods
                  </th>
                  <th className="py-2 px-3 border-b border-r border-slate-200 text-left text-xs font-medium text-slate-600 uppercase tracking-wider">
                    HSN/SAC Code
                  </th>
                  <th className="py-2 px-3 border-b border-r border-slate-200 text-center text-xs font-medium text-slate-600 uppercase tracking-wider">
                    Qty
                  </th>
                  <th className="py-2 px-3 border-b border-r border-slate-200 text-center text-xs font-medium text-slate-600 uppercase tracking-wider">
                    Unit
                  </th>
                  <th className="py-2 px-3 border-b border-r border-slate-200 text-right text-xs font-medium text-slate-600 uppercase tracking-wider">
                    Rate
                  </th>
                  <th className="py-2 px-3 border-b border-r border-slate-200 text-right text-xs font-medium text-slate-600 uppercase tracking-wider">
                    Taxable Amount
                  </th>
                  {invoice.taxType === 'igst' ? (
                    <>
                      <th className="py-2 px-3 border-b border-r border-slate-200 text-center text-xs font-medium text-slate-600 uppercase tracking-wider">
                        IGST %
                      </th>
                      <th className="py-2 px-3 border-b border-slate-200 text-right text-xs font-medium text-slate-600 uppercase tracking-wider">
                        IGST Amount
                      </th>
                    </>
                  ) : (
                    <>
                      <th className="py-2 px-3 border-b border-r border-slate-200 text-center text-xs font-medium text-slate-600 uppercase tracking-wider">
                        SGST %
                      </th>
                      <th className="py-2 px-3 border-b border-r border-slate-200 text-right text-xs font-medium text-slate-600 uppercase tracking-wider">
                        SGST Amount
                      </th>
                      <th className="py-2 px-3 border-b border-r border-slate-200 text-center text-xs font-medium text-slate-600 uppercase tracking-wider">
                        CGST %
                      </th>
                      <th className="py-2 px-3 border-b border-slate-200 text-right text-xs font-medium text-slate-600 uppercase tracking-wider">
                        CGST Amount
                      </th>
                    </>
                  )}
                </tr>
              </thead>
              <tbody>
                {invoice.items.map((item, index) => (
                  <tr key={index} className={index % 2 === 0 ? 'bg-white' : 'bg-slate-50'}>
                    <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-slate-800">
                      {index + 1}
                    </td>
                    <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-slate-800">
                      {item.description}
                    </td>
                    <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-slate-800">
                      {item.hsnSacCode}
                    </td>
                    <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-center text-slate-800">
                      {item.quantity}
                    </td>
                    <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-center text-slate-800">
                      {item.unit}
                    </td>
                    <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-right text-slate-800">
                      ₹{item.rate.toFixed(2)}
                    </td>
                    <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-right text-slate-800">
                      ₹{item.taxableAmount.toFixed(2)}
                    </td>
                    {invoice.taxType === 'igst' ? (
                      <>
                        <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-center text-slate-800">
                          {item.igstPercentage}%
                        </td>
                        <td className="py-2 px-3 border-b border-slate-200 text-sm text-right text-slate-800">
                          ₹{item.igstAmount.toFixed(2)}
                        </td>
                      </>
                    ) : (
                      <>
                        <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-center text-slate-800">
                          {item.sgstPercentage}%
                        </td>
                        <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-right text-slate-800">
                          ₹{item.sgstAmount.toFixed(2)}
                        </td>
                        <td className="py-2 px-3 border-b border-r border-slate-200 text-sm text-center text-slate-800">
                          {item.cgstPercentage}%
                        </td>
                        <td className="py-2 px-3 border-b border-slate-200 text-sm text-right text-slate-800">
                          ₹{item.cgstAmount.toFixed(2)}
                        </td>
                      </>
                    )}
                  </tr>
                ))}
              </tbody>
              <tfoot>
                <tr className="bg-slate-100">
                  <td colSpan={6} className="py-2 px-3 border-b border-r border-slate-200 text-right font-medium">
                    Total:
                  </td>
                  <td className="py-2 px-3 border-b border-r border-slate-200 text-right font-medium">
                    ₹{invoice.items.reduce((sum, item) => sum + item.taxableAmount, 0).toFixed(2)}
                  </td>
                  {invoice.taxType === 'igst' ? (
                    <>
                      <td className="py-2 px-3 border-b border-r border-slate-200"></td>
                      <td className="py-2 px-3 border-b border-slate-200 text-right font-medium">
                        ₹{invoice.items.reduce((sum, item) => sum + item.igstAmount, 0).toFixed(2)}
                      </td>
                    </>
                  ) : (
                    <>
                      <td className="py-2 px-3 border-b border-r border-slate-200"></td>
                      <td className="py-2 px-3 border-b border-r border-slate-200 text-right font-medium">
                        ₹{invoice.items.reduce((sum, item) => sum + item.sgstAmount, 0).toFixed(2)}
                      </td>
                      <td className="py-2 px-3 border-b border-r border-slate-200"></td>
                      <td className="py-2 px-3 border-b border-slate-200 text-right font-medium">
                        ₹{invoice.items.reduce((sum, item) => sum + item.cgstAmount, 0).toFixed(2)}
                      </td>
                    </>
                  )}
                </tr>
              </tfoot>
            </table>
          </div>
          
          <div className="mb-6 flex justify-end">
            <div className="w-80 border border-slate-200 rounded-md overflow-hidden">
              <div className="bg-slate-50 p-3 border-b border-slate-200">
                <div className="flex justify-between">
                  <span className="font-medium">Total Taxable Amount:</span>
                  <span>₹{invoice.items.reduce((sum, item) => sum + item.taxableAmount, 0).toFixed(2)}</span>
                </div>
              </div>
              <div className="p-3 border-b border-slate-200">
                {invoice.taxType === 'igst' ? (
                  <div className="flex justify-between">
                    <span className="font-medium">Total IGST:</span>
                    <span>₹{invoice.items.reduce((sum, item) => sum + item.igstAmount, 0).toFixed(2)}</span>
                  </div>
                ) : (
                  <>
                    <div className="flex justify-between mb-1">
                      <span className="font-medium">Total SGST:</span>
                      <span>₹{invoice.items.reduce((sum, item) => sum + item.sgstAmount, 0).toFixed(2)}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="font-medium">Total CGST:</span>
                      <span>₹{invoice.items.reduce((sum, item) => sum + item.cgstAmount, 0).toFixed(2)}</span>
                    </div>
                  </>
                )}
              </div>
              <div className="p-3 bg-blue-900 text-white">
                <div className="flex justify-between text-lg">
                  <span className="font-bold">Grand Total:</span>
                  <span className="font-bold">₹{invoice.grandTotal.toFixed(2)}</span>
                </div>
              </div>
            </div>
          </div>
          
          <div className="mb-6 p-3 border border-slate-200 rounded-md bg-slate-50">
            <p className="text-sm"><span className="font-medium">Amount in Words:</span> {invoice.totalInWords}</p>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div className="border border-slate-200 rounded-md p-4">
              <h3 className="font-bold border-b pb-2 mb-2">Bank Details</h3>
              <p className="mb-1"><span className="font-medium">Bank Name:</span> {defaultInfo?.bankName || 'SBI'}</p>
              <p className="mb-1"><span className="font-medium">A/C No:</span> {defaultInfo?.accountNo || '30373757750'}</p>
              <p className="mb-1"><span className="font-medium">IFSC Code:</span> {defaultInfo?.ifscCode || 'SBIN0015580'}</p>
              <p><span className="font-medium">Branch:</span> {defaultInfo?.branch || 'ASILMETTA'}</p>
            </div>
            <div className="border border-slate-200 rounded-md p-4">
              <h3 className="font-bold border-b pb-2 mb-2">Terms & Conditions</h3>
              {defaultInfo?.terms.map((term, index) => (
                <p key={index} className="mb-1 text-sm">{index + 1}. {term}</p>
              )) || (
                <>
                  <p className="mb-1 text-sm">1. Goods once sold cannot be taken back.</p>
                  <p className="mb-1 text-sm">2. Interest @24% per annum will be charged on overdue accounts.</p>
                  <p className="text-sm">3. Any dispute arising out of this transaction will be subject to Visakhapatnam jurisdiction.</p>
                </>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default InvoicePreview;